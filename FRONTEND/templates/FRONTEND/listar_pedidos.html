<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            min-height: 100vh;
        }
        .table-header {
            background-color: #4b5563;
            color: white;
        }
    </style>
</head>
<body>
    {% include 'FRONTEND/_header.html' %}
    
    <main class="container mx-auto p-4 sm:p-8 lg:p-12">
        <div class="bg-white shadow-xl rounded-2xl p-6 sm:p-10 max-w-7xl mx-auto">

            <div class="flex justify-between items-center border-b-2 border-indigo-100 pb-4 mb-8">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800">
                    Mis √ìrdenes de Transporte
                </h1>
                <a href="{% url 'frontend:crear_pedido' %}" 
                class="px-5 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md">
                    + Nuevo Pedido
                </a>
            </div>
            
            <div class="bg-blue-50 p-4 border-l-4 border-blue-400 text-blue-800 rounded-lg mb-8">
                <p>Aqu√≠ se listar√°n todos los pedidos. Haz clic en **"Ver Detalle"** para cargar la informaci√≥n espec√≠fica en el bloque de seguimiento.</p>
            </div>

            <div id="detalle-pedido" class="bg-indigo-50 p-6 border-l-4 border-indigo-600 text-gray-800 rounded-lg mb-8 transition-all duration-300 ease-in-out">
                <h2 id="detalle-titulo" class="text-2xl font-bold mb-4 text-indigo-700">üöö Detalle y Seguimiento: BOCG-00121</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div id="detalle-info">
                        <p class="mb-2"><strong>Transportista Asignado:</strong> <span class="text-green-700 font-semibold">Transportes √Åguila Ltda.</span></p>
                        <p class="mb-2"><strong>Ruta:</strong> Fontib√≥n, Bogot√° (Origen) ‚Üí Chapinero, Bogot√° (Destino)</p>
                        <p class="mb-2"><strong>Estado:</strong> <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">EN TR√ÅNSITO</span></p>
                        <p class="mb-2"><strong>Distancia:</strong> 15,9 km</p>
                        <p class="mb-2"><strong>Tiempo Estimado:</strong> 57 minutos</p>
                        <p class="mb-4 text-red-700 font-semibold">
                            ‚ö†Ô∏è Tr√°fico en la ruta: PEOR DE LO HABITUAL con un RETRASO PESADO.
                        </p>
                        <a id="detalle-mapa-link" href="https://www.google.com/maps/dir/Fontib%C3%B3n,+Bogota,+Colombia/Chapinero,+Bogota,+Colombia/data=!4m14!4m13!1m5!1m1!19sChIJHaPSpV-cP44RRgySMYfH-aU!2m2!1d-74.1433169!2d4.6739144999999995!1m5!1m1!19sChIJgwW_iJ6QP44Rc7wFsOAC5M4!2m2!1d-74.0552684!2d4.6548153!3e0" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-medium transition duration-300">
                            Ver Mapa Completo en Google Maps ¬ª
                        </a>
                    </div>
                    <div id="detalle-mapa" class="bg-white p-2 rounded-lg shadow-inner">
                        <p class="text-sm font-semibold text-gray-600 mb-2">Ruta de Transporte Local (Fontib√≥n a Chapinero)</p>
                        
                        <p class="text-xs text-gray-500 mt-2">*El mapa muestra el recorrido local de la orden en tr√°nsito dentro de Bogot√°.*</p>
                    </div>
                </div>
            </div>

            <div class="overflow-x-auto rounded-lg shadow-md border border-gray-100">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider table-header rounded-tl-lg">ID Pedido</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider table-header">Fecha</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider table-header">Destino (Bogot√°)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider table-header">Mercanc√≠a</th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider table-header">Peso (Kg)</th>
                            <th class="px-6 py-3 text-center text-xs font-medium uppercase tracking-wider table-header">Estado</th>
                            <th class="px-6 py-3 text-center text-xs font-medium uppercase tracking-wider table-header rounded-tr-lg">Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="tabla-pedidos">
                        <tr id="pedido-BOCG-00123" class="hover:bg-gray-50"
                            data-id="BOCG-00123" 
                            data-fecha="2025-11-18"
                            data-origen="Fontib√≥n, Bogot√°"
                            data-destino="Usaqu√©n, Bogot√°"
                            data-mercancia="Muestras (2 cajas)"
                            data-peso="2.0"
                            data-estado="PENDIENTE"
                            data-transportista="Sin Asignar"
                            data-distancia="N/A"
                            data-tiempo="N/A"
                            data-mapa-link="#"
                            data-mapa-img="Mapa no disponible. Pendiente de asignar transportista.">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-600">BOCG-00123</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-11-18</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Usaqu√©n</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Muestras (2 cajas)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">2.0</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                    PENDIENTE
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="mostrarDetalle('BOCG-00123')" class="text-indigo-600 hover:text-indigo-900 focus:outline-none">Ver Detalle</button>
                            </td>
                        </tr>
                        <tr id="pedido-BOCG-00122" class="hover:bg-gray-50"
                            data-id="BOCG-00122" 
                            data-fecha="2025-11-15"
                            data-origen="Fontib√≥n, Bogot√°"
                            data-destino="Suba, Bogot√°"
                            data-mercancia="Documentos Urgentes"
                            data-peso="0.8"
                            data-estado="ENTREGADO"
                            data-transportista="Mensajer√≠a R√°pida SAS"
                            data-distancia="22.5 km"
                            data-tiempo="45 min"
                            data-mapa-link="#"
                            data-mapa-img="El pedido ha sido entregado exitosamente. La ruta est√° archivada.">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-600">BOCG-00122</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-11-15</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Suba</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Documentos Urgentes</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">0.8</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    ENTREGADO
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="mostrarDetalle('BOCG-00122')" class="text-indigo-600 hover:text-indigo-900 focus:outline-none">Ver Detalle</button>
                            </td>
                        </tr>
                        <tr id="pedido-BOCG-00121" class="hover:bg-gray-50 bg-indigo-50 border-indigo-600 border-l-2"
                            data-id="BOCG-00121" 
                            data-fecha="2025-11-10"
                            data-origen="Fontib√≥n, Bogot√°"
                            data-destino="Chapinero, Bogot√°"
                            data-mercancia="Mobiliario"
                            data-peso="120.0"
                            data-estado="EN TR√ÅNSITO"
                            data-transportista="Transportes √Åguila Ltda."
                            data-distancia="15,9 km"
                            data-tiempo="57 minutos"
                            data-mapa-link="https://www.google.com/maps/dir/Fontib%C3%B3n,+Bogota,+Colombia/Chapinero,+Bogota,+Colombia/data=!4m14!4m13!1m5!1m1!19sChIJHaPSpV-cP44RRgySMYfH-aU!2m2!1d-74.1433169!2d4.6739144999999995!1m5!1m1!19sChIJgwW_iJ6QP44Rc7wFsOAC5M4!2m2!1d-74.0552684!2d4.6548153!3e0"
                            data-mapa-img=""
                            data-mapa-caption="Ruta de Transporte Local (Fontib√≥n a Chapinero)">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-indigo-700">BOCG-00121</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-11-10</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Chapinero</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Mobiliario</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">120.0</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                    EN TR√ÅNSITO
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-bold">
                                <button onclick="mostrarDetalle('BOCG-00121')" class="text-indigo-700 hover:text-indigo-900 underline focus:outline-none">Detalles Vistos</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Funci√≥n para actualizar el bloque de detalles con la informaci√≥n de la fila
        function mostrarDetalle(pedidoId) {
            const row = document.getElementById(`pedido-${pedidoId}`);
            if (!row) return;

            // Obtener datos
            const id = row.dataset.id;
            const origen = row.dataset.origen;
            const destino = row.dataset.destino;
            const estado = row.dataset.estado;
            const transportista = row.dataset.transportista;
            const distancia = row.dataset.distancia;
            const tiempo = row.dataset.tiempo;
            const mapaLink = row.dataset.mapaLink;
            const mapaImg = row.dataset.mapaImg;

            // 1. Actualizar el T√≠tulo
            document.getElementById('detalle-titulo').innerHTML = `üöö Detalle y Seguimiento: ${id}`;
            
            // 2. Actualizar el Bloque de Informaci√≥n
            let infoHTML = `
                <p class="mb-2"><strong>Transportista Asignado:</strong> <span class="text-green-700 font-semibold">${transportista}</span></p>
                <p class="mb-2"><strong>Ruta:</strong> ${origen} ‚Üí ${destino}</p>
                <p class="mb-2"><strong>Estado:</strong> ${getEstadoSpan(estado)}</p>
                <p class="mb-2"><strong>Distancia:</strong> ${distancia}</p>
                <p class="mb-2"><strong>Tiempo Estimado:</strong> ${tiempo}</p>
            `;

            // Agregar notas espec√≠ficas por estado (simulaci√≥n)
            if (estado === 'EN TR√ÅNSITO') {
                infoHTML += `<p class="mb-4 text-red-700 font-semibold">‚ö†Ô∏è Tr√°fico en la ruta: PEOR DE LO HABITUAL con un RETRASO PESADO.</p>`;
            } else if (estado === 'ENTREGADO') {
                infoHTML += `<p class="mb-4 text-green-700 font-semibold">‚úÖ El pedido fue entregado exitosamente el ${row.dataset.fecha}.</p>`;
            } else if (estado === 'PENDIENTE') {
                infoHTML += `<p class="mb-4 text-gray-700 font-semibold">‚è≥ En espera de asignaci√≥n de transportista para la fecha ${row.dataset.fecha}.</p>`;
            } else {
                infoHTML += `<p class="mb-4"></p>`;
            }
            
            document.getElementById('detalle-info').innerHTML = infoHTML;
            
            // 3. Actualizar el Mapa y Enlace
            const mapaContenedor = document.getElementById('detalle-mapa');
            mapaContenedor.innerHTML = `
                <p class="text-sm font-semibold text-gray-600 mb-2">${row.dataset.mapaCaption || 'Mapa de la Orden'}</p>
                ${mapaImg === '#' || mapaImg.includes('no disponible') ? `<div class="p-4 bg-gray-100 rounded-lg text-center text-gray-500 h-48 flex items-center justify-center">Ruta/Mapa no disponible para este estado.</div>` : mapaImg}
                <p class="text-xs text-gray-500 mt-2">*${row.dataset.mapaCaption || mapaImg}*</p>
            `;

            // 4. Agregar el enlace al mapa solo si est√° disponible
            if (mapaLink !== '#') {
                 document.getElementById('detalle-info').innerHTML += `
                    <a href="${mapaLink}" target="_blank" class="text-indigo-600 hover:text-indigo-800 font-medium transition duration-300 mt-2 block">
                        Ver Mapa Completo en Google Maps ¬ª
                    </a>
                `;
            }

            // 5. Actualizar estilos de la tabla (resaltar la fila activa)
            document.querySelectorAll('#tabla-pedidos tr').forEach(tr => {
                tr.classList.remove('bg-indigo-50', 'border-indigo-600', 'border-l-2');
            });
            row.classList.add('bg-indigo-50', 'border-indigo-600', 'border-l-2');
        }

        function getEstadoSpan(estado) {
            const baseClass = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full';
            switch (estado) {
                case 'PENDIENTE':
                    return `<span class="${baseClass} bg-yellow-100 text-yellow-800">${estado}</span>`;
                case 'ENTREGADO':
                    return `<span class="${baseClass} bg-green-100 text-green-800">${estado}</span>`;
                case 'EN TR√ÅNSITO':
                default:
                    return `<span class="${baseClass} bg-blue-100 text-blue-800">${estado}</span>`;
            }
        }
        
        // Cargar el detalle por defecto al iniciar la p√°gina
        window.onload = () => mostrarDetalle('BOCG-00121');
    </script>
</body>
</html>